<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ohala, blog" />










<meta property="og:type" content="website">
<meta property="og:title" content="大亮的实验室">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="大亮的实验室">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大亮的实验室">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>大亮的实验室</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">大亮的实验室</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">码田003</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/tags.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/page.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/06/23/vc6-e5-b7-a5-e7-a8-8b-e9-a1-b9-e7-9b-ae-e6-94-b9-e5-90-8d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/23/vc6-e5-b7-a5-e7-a8-8b-e9-a1-b9-e7-9b-ae-e6-94-b9-e5-90-8d/" itemprop="url">VC6工程项目改名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-06-23T23:49:03+08:00">
                2016-06-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VC6和VS201X/" itemprop="url" rel="index">
                    <span itemprop="name">VC6和VS201X</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VC6和VS201X/利器与技巧/" itemprop="url" rel="index">
                    <span itemprop="name">利器与技巧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div>首先，网上找了个工具改名的，VCRename用了一下成功，注意新生成的目录中，dsw和dsp文件一定要改过来了。</div><br><div>然后，用新的改名后的工程编译出新程序。</div><br><div>但是，如果你的旧程序是个互斥的机制，即只能启动一个实例的情况。</div><br><div>那么，你会发现，虽然，你用改名工具把文件和工程都改了，但是新程序和改名前的程序不能同时启动。</div><br><div>差在哪里呢。</div><br><div>就是app_title.往细了说是，底层的m_pszAppname还在共同一个，并没有变化成功，所以把这个变量改名了，程序才不会被互斥的。那么什么会关联这个变量呢。就是资源文件。但有人说改名工具已经把资源文件的名字改了。可是其中的内容并没有变，这是原理了。</div><br><div></div><br><div>所以，打开资源文件的页签，找”String Table”.</div><br><div>在表格中找到，afx_ids_app_title 把它的值改名同于你的新名字，然后再编译后，新旧两程序同时可启动并不互斥了。</div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/17/window-e5-bc-80-e5-8f-91-e4-b9-8b-e9-a1-b9-e7-9b-ae-e5-ae-8f-e5-ae-9a-e4-b9-89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/17/window-e5-bc-80-e5-8f-91-e4-b9-8b-e9-a1-b9-e7-9b-ae-e5-ae-8f-e5-ae-9a-e4-b9-89/" itemprop="url">window开发之项目宏定义</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-17T10:59:50+08:00">
                2016-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VC6和VS201X/" itemprop="url" rel="index">
                    <span itemprop="name">VC6和VS201X</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/VC6和VS201X/利器与技巧/" itemprop="url" rel="index">
                    <span itemprop="name">利器与技巧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div>转来一个文章，对VC6下项目建立和解决编译问题时，很有帮助。</div><br><div></div><br><div>常见的编译参数VC建立项目时总会定义”Win32”。控制台程序会定义”_CONSOLE”，否则会定义”_WINDOWS”。Debug版定义”_DEBUG”，Release版定义”NDEBUG”</div><br><div>　　与MFC DLL有关的编译常数包括：</div><br><div>　　_WINDLL 表示要做一个用到MFC的DLL</div><br><div>　　_USRDLL 表示做一个用户DLL（相对MFC扩展DLL而言）</div><br><div>　　_AFXDLL 表示使用MFC动态链接库的 regular DLL</div><br><div>　　_AFXEXT 表示要做一个MFC扩展DLL</div><br><div>　　所以：</div><br><div>　　Regular, statically linked to MFC _WINDLL,_USRDLL</div><br><div>　　Regular, using the shared MFC DLL _WINDLL,_USRDLL,_AFXDLL</div><br><div>　　Extension DLL _WINDLL,_AFXDLL,_AFXEXT</div><br><div></div><br><div></div><br><div>Building Your DLL</div><br><div></div><br><div></div><br><div>When compiling regular DLLs that statically link to MFC, the symbols “_USRDLL” and “_WINDLL” must be defined. Your DLL code must also be compiled with the following compiler switches:</div><br><div></div><br><div>•/D_WINDLL      signifies the compilation is for a DLL</div><br><div>•/D_USRDLL      specifies you are building a regular DLL</div><br><div></div><br><div></div><br><div></div><br><div></div><br><div>When compiling regularDLLs that statically link to MFC, the symbols “_USR DLL” and”_WINDLL” must be defined. Your DLL code must also be compile dwith the following compiler switches:</div><br><div></div><br><div>When compiling regular DLLs that dynamicallylink to MFC, you must define t he above symbols and use the above compilerswitches. Additionally, the sy mbol “_AFXDLL” must be definedand your DLL code must be compiled with:</div><br><div></div><br><div>•/D_AFXDLL     specifies that you are building a regular DLL that dynamicall y links to MFC</div><br><div></div><br><div>The interfaces (APIs) between the application and the DLL must beexplicitlyexported. It is recommended that you define your interfaces to be lowbandw idth, sticking to C interfaces where possible. More direct C interfaces areeasi er to maintain than more complex C++ classes.</div><br><div></div><br><div>Place your APIs in aseparate header that can be included by both C and C++files (that way you won’tlimit your DLL customers to C++ programmers). Se e the header ScreenCap.h in theMFC Advanced Concepts sample DLLScreen Cap for an example. To export yourfunctions, enter them in theEXPORTSs ection of your moduledefinition file (.DEF) or include<strong>declspec(dllexpor t)on yourfunction definitions. Use</strong>declspec(dllimport)to import thesefunctions into the client executable.</div><br><div></div><br><div>You must add theAFX_MANAGE_STATEmacro at the beginning of all the e xportedfunctions in regular DLLs that dynamically link to MFC to set the curr ent modulestate to the one for the DLL. This is done by adding the followingline of codeto the beginning of functions exported from the DLL:</div><br><div></div><br><div>AFX_MANAGE<em>STATE(AfxGetStaticModuleState( ))</em></div><br><div></div><br><div>WinMain-&gt;DllMain</div><br><div></div><br><div>The MFC library defines the standard Win32DllMain entry point that initializ es yourCWinAppderived object as in a normal MFC application. Placeall DLL-specific initialization in theInitInstancememberfunction as in a normal MFC application.</div><br><div></div><br><div><br><br><em> </em> *<br><br></div><br><div>最近碰到问题是，一个静态库，没有编译成多线程选项，致使在console中使用正常，新建一个mfc app中使用就不成了。</div><br><div>提示了一堆和CTYPE.h中定义的pctype，timezone,mb*类的错误。</div><br><div>后来，把静态库，用多线程重编译，并且，用“不定义所有宏”选项，置了一下，然后，静态库就可以被mfc exe来使用了，虽然库并不依赖MFC。当然，此前有winsock的重定义的问题。后来在stdafx.h中加了winsock2.h的引用后，就解决了。</div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/11/vc6-e7-9a-84-e7-8e-af-e5-a2-83-e5-b0-8f-e7-bb-93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/11/vc6-e7-9a-84-e7-8e-af-e5-a2-83-e5-b0-8f-e7-bb-93/" itemprop="url">VC6的环境小结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-11T16:08:06+08:00">
                2016-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/" itemprop="url" rel="index">
                    <span itemprop="name">c/C++</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/VC6和VS201X/" itemprop="url" rel="index">
                    <span itemprop="name">VC6和VS201X</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/VC6和VS201X/windows/" itemprop="url" rel="index">
                    <span itemprop="name">windows</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/VC6和VS201X/windows/开发语言/" itemprop="url" rel="index">
                    <span itemprop="name">开发语言</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/VC6和VS201X/windows/开发语言/系统平台/" itemprop="url" rel="index">
                    <span itemprop="name">系统平台</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div>安装：</div><br><div>现在主要有win7,win10，但后者还没听说可以装成功。不过好在有虚机嘛。所以，只聊下win7的VC6安装。</div><br><div>VC6的安装源你总应该拿到，最好是SP6的。</div><br><div>如果是英文版本，安装会少些步骤，有一个是overwrite JIT setting的对话框，网查后我选择了否。</div><br><div>如果是中文版本，请寻找帖子，名为：彻底解决兼容问题：Windows 7下载安装 Visual C++ 6_0(VC6) 全程图解</div><br><div></div><br><div>一步步安装即可，VSS和MSDN都可跳过不安装。</div><br><div></div><br><div>最重要的就是插件了，这个才是彰显尊贵的手段。</div><br><div>filetool,wndtab,VA,VC6lineNumber</div><br><div>一个都不能少，全破解版（自己搜吧）。</div><br><div></div><br><div>配置：</div><br><div>1，用标准库，要注意&lt;&gt;的内容两边加空格 ，并且#pragma   warning(disable:4786)来屏闭VC6中的使用标准库的警告。</div><br><div></div><br><div>2，用C++运行程序时总是出现这个错误BSCMAKE: error BK1510 : corrupt .SBR file ‘.\Debug\StdAfx.sbr’，在C/C++—&gt;gernal中取消生成浏览信息的选项。</div><br><div></div><br><div>3，PROJECT-&gt;SETING-&gt;C/C++-&gt;PREPROCESSOR-&gt;定义 _AFXDLL,也就是C/C++选项中定义了宏  用_AFCDLL 取代 USERDLL 能解决很多nafxcwn.lib开头的链接错误。</div><br><div></div><br><div>4，Link选项中ignore default lib，根据方式设定，手工加/NODEFAULTLIB:或者填库名。</div><br><div></div><br><div>5，VC6下导出类中的静态成员需要“壳子”才可以调用，而在VS2012中，却直接可用。当不同的环境生成的dll或客户端相互调用时，要注意字符集问题，VC6并不是unicode的。</div><br><div></div><br><div>6，要声明通用函数时，可以不加；在{}后面，但应该声明为static，这样可以避免重复定义的报错。</div><br><div></div><br><div>7，string 的split算法，replace,trim需要自己写算法，最后找到使用模板的。</div><br><div></div><br><div>8，在有unicode的项目中，在循环中使用W2A()可能会有报错，或者提示为，run-time check fail #2 stack …，内存操作越界之类，在VS2012中项目–C\C++设置中，改掉一个设置，“基本运行时检查”从“两者(/RTC1，等同于 /RTCsu) (/RTC1)”换成默认值。其实出现它的问题，还是在于使用scanf时，“%02x”的操作数组应该至少是3，要包含个’\0’的。</div><br><div></div><br><div>9，项目是要供别人调用的dll，要在配置中使用/MD.</div><br><div></div><br><div>10，要通过exe来调度dll时，要配置debug session和work directory</div><br><div></div><br><div>11，当出现外部链接错误时，要先检查link中的lib文件，是否存在于项目目录中。并不需要dll，因为只是链接步骤。</div><br><div></div><br><div>12，字符集问题，VC6是基于MBCS的（有宏定义，当然可以强制成unicode），对于中文用两字节，而字母和数字用一个字节。而VS201X，都是用unicode默认的，所以也就存在于宽字符的结构了，和一系列转来转来的操作。</div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/27/e5-82-ac-e5-8a-a0-e8-96-aa-e4-bf-a1-e6-a8-a1-e6-9d-bf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/27/e5-82-ac-e5-8a-a0-e8-96-aa-e4-bf-a1-e6-a8-a1-e6-9d-bf/" itemprop="url">催加薪信---模板</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-27T11:12:50+08:00">
                2016-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂文/" itemprop="url" rel="index">
                    <span itemprop="name">杂文</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div><br><div>—–开源一个未发出的旧文章，它的意义就是娱乐一下吧。</div><br><div></div><br><div>        这是一封热情洋溢的催加薪信，可能会让领导眉头微皱。来公司已然二年，对公司留人的政策也了解一些，所以，本人一直刻守职业操守，并且未烦请领导“谈薪”。现在情况有些不同了。首先合同到期，其次，年龄大了，家庭负担大了，其实，即使情势不逼自己，也需要逼自己一下。</div><br></div><br><div></div><br><div>进了公司做了昌8联AFC和京港MLC两个项目，这期间共离职了七人，刘X，阚XX，宋XX，印XX，芮XX和王XX、王艳X，后两者为MLC项目中段离开，自己成了部门里老员工。宏观上说，人手又少了，负责的工作任务没变还更紧要了；微观上说，我接了刘X的devcomm和手持机代码，老阚的mlc代码，魁X的工作和浩X应该扛起来的压力。现在业务服务器后台90%的工作在我这里，同时票制票价改革，庆瑞那边又让我TVM改造。职位已经模糊，一会是开发人员，一会是现场运维和支持，凌晨五点去平西府，一会又要加班赶港铁MLC改bug，开发新功能。</div><br><div></div><br><div>每离职一个自己工作差不多加一项，最艰苦的过程就是浩然突然离开，业务服务器bug成堆，现在，票改将完，接手的业务服务器也趋于稳定。</div><br><div></div><br><div>再有二个月就满两年了，是个合适的时间提出这个请求，领导们，给我加薪吧！（别紧眉头，该来的就会来）要求达到刚进公司时的期望月薪(比现在多2K)再加1K.</div><br><div></div><br><div>对于本人当时期望的月薪可找刘XX和刘XX去印证。对于10年工作经验的我来说，深知在内部涨薪基本上是很难的，所以，我一直也没提要求，只是情势所逼，而且现在做出了一些成绩，并且感觉明显的工酬不同步了，当然本人也不会自寻烦恼的侦查都谁涨了工资而去攀比。但最基本的一个理论是：在一个公司工作两年，却还没拿到入职的期望月薪将是比较遗憾的，所以我们一起来分析一下这后面1K的必要性，绝对划算的“买卖”。</div><br><div></div><br><div>1，余XX推荐我来，本人降薪加入，为能在公司稳定的工作中进步，所以，我也希望能把积累的经验和余老师的架构应用在未来公司的产品中，这样才是双赢。</div><br><div></div><br><div>2，在部门离职这么多程序员后，需要能干活的，有职业操守和做事原则的人，原AFC项目组的人手一个站配三个人都不些不够了。</div><br><div></div><br><div>3，我是个听话的人，自己技术能力和赶兴趣的学习方向和公司需求有冲突时，我选择后者，又或者任务没有任何技术含量我也愿意去做。因为和公司成为利益共同体后，也能成为命运共同体。</div><br><div></div><br><div>4，不得不承认，程序员是青春饭。未来的3-5年将是一个程序员，也就是我的黄金时期，此时买不上价钱，也就难再“嫁”出去了，这也是为何公司已经空出了6个离职者的工资单的原因吧。</div><br><div></div><br><div>5，地铁就一个ACC，两个MLC，身为报价千万的项目组中核心人员之一，我对于一个想发展起来的软件部门能做到传承和积累。</div><br><div></div><br><div>6，培训一个新手，去接代码容易，但让他能理解并立刻维护和修改不容易。并且还缺少项目中不断夯实的业务积累。经历便是种财富，就像看过猪跑，其实比吃过猪肉更重要 。</div><br><div></div><br><div>7，能以大局为重，即便常被借调，仍然能协调好来自不同项目组领导下达的任务。</div><br><div></div><br><div>8，为避免公司人才结构出现断层，需要把底层的人向大佬们靠近。空降的管理者难接地气，薪金高的技术人员又需要长的时间理解业务，重要的是重新建立信任和合作精神，融洽团队氛围。外来的和尚，如果念错经，成本损失更大，除非以后更远的事不用太关心。</div><br><div></div><br><div>9，毕业十年，自己走的路还算扎实，技术人员知识架构较扎实丰富，是到了选择事业的时候了，相信做对事，跟对人，就会成功。</div><br><div></div><br><div>10，涨工资，其实换个角度来看是要求承担更多的任务和责任。</div><br><div></div><br><div>11，能为足球队明年再战邀请比赛拿名次。</div><br><div></div><br><div>12，物价飞涨，父母退休，有小有老，在没有了去年的加班费的报销和打车补助后，也不愿去聚会毕业十年的同学了（你懂的），负能量到此为止吧，我还能消化掉。</div><br><div></div><br><div>13，对于明年如何策划产品或者梳理项目的积累，本人还是有些想法，比如抽象些应用和层次，形成标准的软件产品。</div><br><div></div><br><div>14，对于下现场，本人住育新附近离平西府三站地，并且本人有时会开车上班，能为公司节约部分交通成本还能顺风同事。</div><br><div></div><br><div>15，加同样的数目的薪水给不同基础的员工，得到的结果是不同的。原来薪水少的员工即便加了可能也难呆长，因为，他们总认为，外面公司对其认值很高，可以再试试，何况，即使短期留在了公司，但是也可能是为别人公司培养了，因为，两三年后，他依然可以找到提升的空间（8–11K以内的职位占人才市场的80%）。因此过了10K左右的人再加薪水的话，可能就终老于此行业或公司了，一定和公司是命运共同体。</div><br><div></div><br><div>以上就是我的一点心得，希望领导能换位思考，理解员工。感谢领导百忙之中阅读这邮件。</div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/15/tinyxml-e4-bd-bf-e7-94-a8-e6-8a-80-e5-b7-a7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/15/tinyxml-e4-bd-bf-e7-94-a8-e6-8a-80-e5-b7-a7/" itemprop="url">tinyxml使用技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-15T15:25:50+08:00">
                2016-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/" itemprop="url" rel="index">
                    <span itemprop="name">c/C++</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/开发语言/" itemprop="url" rel="index">
                    <span itemprop="name">开发语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实在是好用呀，优点比如：<br>1，一次装载到内存，其它地方全用引用即可，一个小指针可以是一个元素，也可是一个节（内部很多子元素）。<br>2，不用管理元素的内存回收，我是没看源码，号称管理的很好。一个父元素删除，它包含的所有子都释放了。<br>3，api较少并且，一目了然。<br>遍历时基本就用三个算法：<br>1）同级的循环（没用遍历以防会误解包括子节点处理）<br>//pParent当然是父了<br>for (TiXmlNode <em>pSTATE = pParent-&gt;FirstChild( “STATE” ); pSTATE; pSTATE = pSTATE-&gt;NextSibling(“STATE” ))<br>{}<br>注意：要用TiXmlNode </em>结构，不要用TiXmlElement<em><br>2）当同级的到了最后一个，NextSibling()会返回个空。这时你可以用跳了。<br>pParent-&gt;IterateChildren( pSTATE )<br>3）以上两个掌握了，就可以玩遍历了。不过，要注意，走到叶子节点时，要跳级。但如果你手工跳了，可能遍历会有重复情况。这时可以使用函数的静态变量喽。可以用静态变量记住父结点。可以用静态list来存放处理过的节点，跳过重复情况。示例代码如下：<br>void handleExportMap(TiXmlNode </em> pSrc)<br>{<br>if (!pSrc ) return;</p>
<p>static TiXmlNode *bodyItem;</p>
<p>if (“FRAME_BODY” == pSrc-&gt;ValueTStr())<br>{<br>bodyItem = pSrc ;<br>}<br>static TiXmlNode *curpItem;<br>int t = pSrc -&gt;Type();<br>printf( “type %d \n” , t);</p>
<p>switch (t)<br>{<br>case TiXmlNode :: TINYXML_DOCUMENT:<br>printf( “Document” );<br>break ;</p>
<p>case TiXmlNode :: TINYXML_ELEMENT:<br>printf( “Element [%s]” , pSrc -&gt;Value());<br>//<br>if (“CONTENT” == pSrc-&gt;ValueTStr())<br>{<br>curpItem = pSrc ;<br>}<br>if (“MAP” == pSrc-&gt;ValueTStr())<br>{<br>//跳过MAP的处理<br>pSrc = curpItem-&gt;IterateChildren(pSrc -&gt;Parent());</p>
<p>if (!pSrc )<br>return ;<br>else<br>printf( “Element [%s]” , pSrc -&gt;Value());<br>}<br>if (“STATE” == pSrc-&gt;ValueTStr() &amp;&amp; pSrc == pSrc -&gt;Parent()-&gt;LastChild())<br>{<br>//跳过STATE的处理<br>//map中的state<br>pSrc = curpItem-&gt;IterateChildren(pSrc -&gt;Parent()-&gt;Parent());</p>
<p>if (!pSrc )<br>return ;<br>else<br>printf( “Element [%s]” , pSrc -&gt;Value());<br>}</p>
<p>if (“ITEM” == pSrc-&gt;ValueTStr())<br>{</p>
<p>printf( “Element [%s]” , pSrc -&gt;Value());</p>
<p>if (!pSrc -&gt;NoChildren())<br>{<br>if (!bMoveItems(pSrc ))<br>return ;<br>}</p>
<p>} //end if (!pSrc-&gt;NoChildren())<br>if (“MESSAGE” == pSrc-&gt;ValueTStr())<br>{<br>curpItem = pSrc ;<br>if (!bMoveItems(pSrc ))<br>return ;<br>}<br>break ;</p>
<p>case TiXmlNode :: TINYXML_COMMENT:<br>printf( “Comment: [%s]” , pSrc -&gt;Value());<br>break ;</p>
<p>case TiXmlNode :: TINYXML_UNKNOWN:<br>printf( “Unknown” );<br>break ;</p>
<p>case TiXmlNode :: TINYXML_TEXT:<br>printf( “Text: [%s]\n” , pSrc -&gt;ToText()-&gt;Value());<br>break ;</p>
<p>case TiXmlNode :: TINYXML_DECLARATION:<br>printf( “Declaration” );<br>break ;<br>default :<br>break ;<br>}</p>
<p>if (pSrc -&gt;NoChildren())<br>{<br>pSrc = pSrc -&gt;NextSibling();</p>
<p>handleExportMap( pSrc );<br>}<br>else<br>{<br>//过滤，直到合法<br>while (pSrc = pSrc-&gt;FirstChild())<br>{<br>handleExportMap( pSrc );</p>
<p>}</p>
<p>}<br>}<br>在这个遍历的框架基础上，可以变化和设计出你的需求了，注意，要分化任务，只做遍历，和只做节点的处理，不要混在一起，不然，一个bug两三天呀。上面的bMoveItems就是当定位到了ITEM节点时，我调用其它的业务处理。因为，人只关注ITEM节点，所以它有一些子节点MAP或子子节点STATE，都在上面一一跳过了。</p>
<p>最后，附上“米”，好“下锅”，注意层次。<br>&lt;?xml version=”1.0” encoding=”UTF-8” ?&gt;<br>&lt;!– edited with XMLSpy v2013 (<a href="http://www.altova.com" target="_blank" rel="noopener">http://www.altova.com</a>) by () –&gt;<br>&lt;LINE ID=”11” VERSION=”1”&gt;<br>&lt;FRAME_HEADER&gt;<br>&lt;ITEM ID=”system_id” LENGTH=”1” CURPOS=”0” /&gt;<br>&lt;ITEM ID=”total_length” LENGTH=”2” CURPOS=”1” MAX_VALUE=”1025” /&gt;<br>&lt;ITEM ID=”multi_flag” LENGTH=”1” CURPOS=”3” DEFAULT=”0” /&gt;<br>&lt;/FRAME_HEADER&gt;<br>&lt;FRAME_BODY&gt;<br>&lt;MESSAGE ID=”NETWORK_ALIVE_STATUS” TYPE=”1” TRANS=”O2N”&gt;<br>&lt;ITEM ID=”message_length” LENGTH=”2” CURPOS=”4” DESC=”消息长度” MIN_VALUE=”13” interal_index=”1” /&gt;<br>&lt;ITEM ID=”time” LENGTH=”4” CURPOS=”6” DESC=”时间” FORMAT=”HHMMSS” interal_index=”2”&gt;<br>&lt;MAP NID=”time” MODE=”1” SAME=”Y” NINDEX=”2” KEY=”time|6|4” DESC=”时间” EX_CODE_KEY=”” /&gt;<br>&lt;/ITEM&gt;<br>&lt;ITEM ID=”version” LENGTH=”2” CURPOS=”10” DESC=”版本” DEFAULT=”01H” interal_index=”3” /&gt;<br>&lt;ITEM ID=”msg_id” LENGTH=”2” CURPOS=”12” DESC=”报文ID” interal_index=”4” /&gt;<br>&lt;CONTENT ID=”data0” DEFAULT_LEN=”3”&gt;<br>&lt;ITEM ID=”line_id” LENGTH=”2” CURPOS=”14” DESC=”线路号” interal_index=”5”&gt;<br>&lt;MAP NID=”line_id” MODE=”1” SAME=”Y” NINDEX=”5” KEY=”line_id|14|2” EX_CODE_KEY=”” /&gt;<br>&lt;/ITEM&gt;<br>&lt;ITEM ID=”status” LENGTH=”1” CURPOS=”16” DESC=”状态字节：1：代表与当前线路号的信息源(server)连接正常；0：代表断开。” interal_index=”6”&gt;<br>&lt;MAP NID=”xt_pkg” MODE=”1” SAME=”N” NINDEX=”6” KEY=”xt_pkg|16|1” EX_CODE_KEY=””&gt;<br>&lt;STATE ID=”11_STATUS_CODE_1” RAWVALUE=”0x00” HINT=”通信中断” SAME=”Y”&gt;0x80&lt;/STATE&gt;<br>&lt;STATE ID=”11_STATUS_CODE_2” RAWVALUE=”0x01” HINT=”通信正常” SAME=”Y”&gt;0x02&lt;/STATE&gt;<br>&lt;/MAP&gt;<br>&lt;/ITEM&gt;<br>&lt;/CONTENT&gt;<br>&lt;/MESSAGE&gt;<br>&lt;MESSAGE ID=”LOAD_DEVICE_STATUS” TYPE=”1” TRANS=”N2O”&gt;<br>&lt;ITEM ID=”message_length” LENGTH=”2” CURPOS=”4” DESC=”消息长度” MIN_VALUE=”12” interal_index=”1” /&gt;<br>&lt;ITEM ID=”time” LENGTH=”4” CURPOS=”6” DESC=”时间” FORMAT=”HHMMSS” interal_index=”2” /&gt;<br>&lt;ITEM ID=”version” LENGTH=”2” CURPOS=”10” DESC=”版本” DEFAULT=”01H” interal_index=”3” /&gt;<br>&lt;ITEM ID=”msg_id” LENGTH=”2” CURPOS=”12” DESC=”报文ID” interal_index=”4” /&gt;<br>&lt;CONTENT ID=”data0” DEFAULT_LEN=”2”&gt;<br>&lt;ITEM ID=”line_id” LENGTH=”2” CURPOS=”14” DESC=”线路号” interal_index=”5” /&gt;<br>&lt;/CONTENT&gt;<br>&lt;/MESSAGE&gt;<br>&lt;/MESSAGE&gt;<br>&lt;/FRAME_BODY&gt;<br>&lt;/LINE&gt;</p>
<p>保存和另存，一个TiXmlDocument的SaveFile()函数就搞定了。<br>生成新的XML时，会用一个api就成了。parent-&gt;LinkEndChild(TiXmlNode *);根据不用我解释了吧。加同级，用parent()找父指针嘛。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/15/e5-8c-97-e4-ba-ac-e5-b7-a5-e4-bd-9c-e5-b1-85-e4-bd-8f-e8-af-81-e6-94-bb-e7-95-a5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/15/e5-8c-97-e4-ba-ac-e5-b7-a5-e4-bd-9c-e5-b1-85-e4-bd-8f-e8-af-81-e6-94-bb-e7-95-a5/" itemprop="url">北京工作居住证攻略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-15T14:43:09+08:00">
                2016-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂文/" itemprop="url" rel="index">
                    <span itemprop="name">杂文</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>朝阳区人才的位置：三元桥，凤凰城附近<br>海淀区人才的位置：北京市海淀区西四环北路73号中关村人才发展中心<br>办理：<br>首先，你要把自己的证件都复印好，不用等待网络上的信息注册后再准备，但完税证明不要提前，因为有效期只有一个月。<br>但办这事的入口，还是你公司为你注册了帐号，然后，你就可以登陆并看到办理居住证的链接了。<br>然后，就是材料最后的准备阶段了，去开完税证明和公司行政打交道完成各种手续。<br>最后，在提交时，想要办小孩上学要注意随迁问题。住址和居住证跨区的小孩上学问题，需要向学校搞清楚。</p>
<p>年检：<br>这其实是公司人力的动作，每年四月，他们应该用他们的企业帐号登陆系统，做操作。</p>
<p>续证：<br>工作居住证到期的前后一个月，要在网上先申请，然后，要去所在区人才，柜台办理。又要拿一大堆打印的申请。</p>
<p>变更：<br>分公司，住址，随迁等种类变更。但重要的是公司变更吧。<br>本人下家也具有工作居住证的资质，所以，变更准备材料如下：<br>（只针对海淀人才）<br>1）居住证原件（这不用说吧）<br>2）关于为XXX同志办理《北京市工作居住证》聘用单位变更的申请———-网找模板，加盖公司章<br>3）聘用单位变更申请———–网找模板，是个人申请，所以不用公章<br>4）营业执照复印副本<br>5）离职证明原件+复印件———-注意复印件也要盖章，经办人签字（附句话：经本人同意与原件内容一致）<br>6）新公司的劳动合同原件+复印件———-注意复印件也要盖章，经办人签字 （附句话： 经本人同意与原件内容一致）<br>不用每页都有章，最好公司有复印件专用的方章，可以在首页和签字页盖章即可。</p>
<p>说什么诚信声明和进入系统打印申请表，这两项并不需要。<br>当你的申请被受理后，海淀人才就告诉我，两个月左右，登录看一下系统中办理的状态，如果是完成，那么，你有两个方式来取回自己的居住证。一，让公司人事去办事时顺便取到，二，自己打印一个介绍信，模板不好找，但当时，我把柜台的模板照了下来。这样，可以自己起草一个，找公司盖章，注意只好盖章后，拿这个介绍信才能自己取到。<br>注销：<br>也是公司人力的动作，当你想在新公司变更或重新办新的，或其它业务时，前公司应该给你注销先。<br>注销后，两个月内个人如果没有延期注销的动作，那么你的居住证生命线就over了</p>
<p>延期注销：<br>当你换的新公司试用期较长，或者暂时没公司，或者工作忙时，可以在注销的两个月最后几天，申请延期注销。<br>那么你就有了6个月的机动时间。当然，你要登陆系统，自己填写申请并提交。如果你的新公司比较确定，要在备注的内容里体现。据说这样<br>会不仅有6个月，即使长一些，也能救起证的生命线。提交成功就行，不用去柜台了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/15/e4-bb-a5qtreeview-e4-b8-ba-e4-be-8b-e4-bb-8b-e7-bb-8dqt-e7-9a-84modelviewitem-e6-a1-86-e6-9e-b6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/15/e4-bb-a5qtreeview-e4-b8-ba-e4-be-8b-e4-bb-8b-e7-bb-8dqt-e7-9a-84modelviewitem-e6-a1-86-e6-9e-b6/" itemprop="url">以Qtreeview为例介绍Qt的model/view/item框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-15T14:34:04+08:00">
                2016-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt/" itemprop="url" rel="index">
                    <span itemprop="name">Qt</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt/利器与技巧/" itemprop="url" rel="index">
                    <span itemprop="name">利器与技巧</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div>因为，Qtreeview是层次容器，所以会复杂。尤其是加子行的时候。</div><br><div>首先，要找到是哪里加子行。有两个思路：位置索引还是item</div><br><div></div><br><div>1）用model的位置索引方式，定位到要加子行的QModelIndex.</div><br><div>2）用item方式，即后台以批量的list加树时，找到item的位置。</div><br><div>3）用model，如果后台的批量item加完就释放，若无从找到，有一个神器就是Model-&gt;itemFromIndex(myparent);这是索引和后台item的桥。</div><br><div></div><br><div>后两种方式归纳来看，也算是从item入手了，而且推荐都使用Item方式加子行，不然，可能会陷入到后台model和view中的QModelIndex的不同步，那个问题会让你乱套的。</div><br><div></div><br><div>然后，找到了加子行的点，就是要找方法了。</div><br><div>1)item-&gt;appendRow(传入item的list);</div><br><div>2)Model-&gt;insertRows(0, 1, myparent); // 添加一行,注意参数是QModelIndex，要理解树模型中子节点的索引机制</div><br><div></div><br><div>虽然，model有自己的appendRow函数，但是，加一行是没问题，分层次加子行时还是不行的。</div><br><div>而且，在分别使用item对象和QModelIndex对象的Data()和setData()时要注意，默认的role参数,一个是0，一个是257.这是绝对的坑儿。</div><br><div>不然，你设置了，总感觉设置的数据为空，不显示。role是一个新维度的概念，使用很方便，只要传入和调出控制好了，是一大神器。</div><br><div></div><br><div>resizecolumncontent也是个不错的技巧，可以在你设置了model后重新调用，根据内容适应宽度。</div><br><div></div><br><div>代码有点乱：但可以上两棵树，并且都有子行。</div><br><div><br><br><em> </em> <em><br><br></em></div><br><div>  //测试绑定线路报文内容到树控件</div><br><div>  QList &lt;QStandardItem &gt; items;</div><br><div>  QList &lt;QStandardItem <em>&gt; childItems;</em></div><br><div></div><br><div>  for (int i = 0; i &lt; 4; ++i)</div><br><div>  {</div><br><div>  QStandardItem item = new QStandardItem( QString (“item L%0” ).arg(i));</div><br><div></div><br><div>  if (0 == i)</div><br><div>  item-&gt;setCheckable( true );</div><br><div>  items.push_back(item);</div><br><div>  }</div><br><div>  lineModel-&gt;appendRow(items);</div><br><div></div><br><div>  for (int i = 0; i &lt; 4; ++i)</div><br><div>  {</div><br><div></div><br><div>  for (int i = 0; i &lt; 4; ++i)</div><br><div>  {</div><br><div>  QStandardItem <em>item = new QStandardItem( QString (“L%0” ).arg(i));</em></div><br><div>  if (0 == i)</div><br><div>  item-&gt;setCheckable( true );</div><br><div></div><br><div>  childItems.push_back(item);</div><br><div>  }</div><br><div>  items.at(i)-&gt;appendRow(childItems);</div><br><div>  //lineModel-&gt;setItem(i, 0, childItems.at(i));</div><br><div>  }</div><br><div>  items.clear();</div><br><div>  childItems.clear();</div><br><div></div><br><div>  int iRow = -1;</div><br><div>  for (int i = 0; i &lt; 4; ++i)</div><br><div>  {</div><br><div>  for (int i = 0; i &lt; 3; ++i)</div><br><div>  {</div><br><div>  QStandardItem item = new QStandardItem( QString (“item R%0” ).arg(i));</div><br><div></div><br><div>  if (0 == i)</div><br><div>  item-&gt;setCheckable( true );</div><br><div>  items.push_back(item);</div><br><div>  }</div><br><div>  //items.at(i)-&gt;appendRow(items);</div><br><div>  //normalModel-&gt;setItem(i, items.at(0));</div><br><div>  normalModel-&gt;appendRow(items);</div><br><div>  items.clear();</div><br><div></div><br><div>  iRow++;</div><br><div>  }</div><br><div>  //方式一，以setdata方式加子行</div><br><div>  //QModelIndex myparent = normalModel-&gt;index(iRow,0);</div><br><div></div><br><div>  // //myparent = normalModel-&gt;index(0, 0, myparent);</div><br><div>  // normalModel-&gt;insertRows(0, 1, myparent); // 添加一行</div><br><div>  // normalModel-&gt;insertColumns(0, 3, myparent); // 添加三列</div><br><div>  // ui.treeView_normal-&gt;reset();</div><br><div>  // ui.treeView_normal-&gt;setModel(normalModel);</div><br><div>  // ui.treeView_normal-&gt;update();</div><br><div>  // emit ui.treeView_normal-&gt;dataChanged(normalModel-&gt;index(0, 0), normalModel-&gt;index(0, 3, myparent));</div><br><div>  ////for (int i = 0; i&lt;3; i++)</div><br><div>  ////{</div><br><div>  // QModelIndex index = normalModel-&gt;index(0, 0, myparent);</div><br><div>  // normalModel-&gt;setData(index, “kk”);</div><br><div>  // ui.treeView_normal-&gt;reset();</div><br><div>  // ui.treeView_normal-&gt;setModel(normalModel);</div><br><div>  // ui.treeView_normal-&gt;update();</div><br><div>  // emit ui.treeView_normal-&gt;dataChanged(normalModel-&gt;index(0, 0), index);</div><br><div>  // normalModel-&gt;insertColumns(0, 1, myparent); // 添加一列</div><br><div>  // index = normalModel-&gt;index(0, 1, myparent);</div><br><div>  // normalModel-&gt;setData(index, “ll”);</div><br><div>  // emit ui.treeView_normal-&gt;dataChanged(normalModel-&gt;index(0, 0), index);</div><br><div>  // ui.treeView_normal-&gt;update();</div><br><div>  // ui.treeView_normal-&gt;setModel(normalModel);</div><br><div>  // normalModel-&gt;insertColumns(0, 1, myparent); // 添加一列</div><br><div>  // index = normalModel-&gt;index(0, 2, myparent);</div><br><div>  // normalModel-&gt;setData(index, “mm”);</div><br><div>  // ui.treeView_normal-&gt;setModel(normalModel);</div><br><div>  // ui.treeView_normal-&gt;update();</div><br><div>  // //ui.treeView_normal-&gt;paintEvent()</div><br><div>  // emit ui.treeView_normal-&gt;dataChanged(normalModel-&gt;index(0, 0), index);</div><br><div>  // ui.treeView_normal-&gt;reset();</div><br><div>  ////}</div><br><div>  //myparent = lineModel-&gt;index(0,0);</div><br><div>  //QModelIndex tmp = lineModel-&gt;index(0, 0,myparent);</div><br><div>  // ui.treeView_line-&gt;setCurrentIndex(tmp);</div><br><div></div><br><div>  //方式二，以model的setitem方式加行</div><br><div>  QModelIndex myparent = normalModel-&gt;index(iRow, 0);</div><br><div>  for (int i = 0; i &lt; 3; ++i)</div><br><div>  {</div><br><div></div><br><div>  QStandardItem <em>item = new QStandardItem( QString (“R%0” ).arg(i));</em></div><br><div>  if (0 == i)</div><br><div>  item-&gt;setCheckable( true );</div><br><div></div><br><div>  childItems.push_back(item);</div><br><div>  }</div><br><div></div><br><div>  //items.at(i)-&gt;appendRow(childItems);</div><br><div>  QStandardItem  tmp = normalModel-&gt;itemFromIndex(myparent);</div><br><div>  tmp-&gt;appendRow(childItems);</div><br><div></div><br><div>  childItems.clear();</div><br><div>  //normalModel-&gt;setItem(iRow, 0, childItems.at(0));</div><br><div>  QStandardItem *item = new QStandardItem( QString (“RE%0” ).arg(0));</div><br><div>  childItems.push_back(item);</div><br><div>  item = new QStandardItem ( QString( “RE%0” ).arg(1));</div><br><div>  childItems.push_back(item);</div><br><div>  item = new QStandardItem ( QString( “RE%0” ).arg(2));</div><br><div>  childItems.push_back(item);</div><br><div></div><br><div>  normalModel-&gt;appendRow(childItems);</div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/04/e8-87-aa-e7-94-b1-e8-a1-8c-e6-b3-b0-e5-9b-bd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/01/04/e8-87-aa-e7-94-b1-e8-a1-8c-e6-b3-b0-e5-9b-bd/" itemprop="url">自由行泰国</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-04T18:06:54+08:00">
                2016-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂文/" itemprop="url" rel="index">
                    <span itemprop="name">杂文</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自由行者干货吐血奉献：<br>感觉用倒叙的时间串起来可读性高。</p>
<p>行程章节：<br>健议，6-10天，选2-3地，6天以内，可以专注1城。很多老外一处一呆就是一个月。租车租房租泰妹已成文化，一盘水果一帮朋友喝到深夜。直到出行前，多看穷游攻略，锦囊啥的。没确定机票前，并不需要订太多景点的票和接机出租啥的，前者用app提前一天解决，点对点的接驳在当地解决吧，可以议价嘛。</p>
<p>首先，倒数半年吧，拿护照买亚航票赶打折是必须的，购时要额外去除保险的点选，因为那是默认选中的坑，不要在意big sort的积分，它是事后才积上去的。对于行李和机上餐可按需选择。注意因为是低价机票，所以不包含这些的。<br>确定了行程，可以细化你每一天的安排了。是一个城市，还是要飞来飞去？由于本人家人5人10天。所以，舍弃了久仰的清迈。因为，考虑到小孩和老人，不能以旅行团一样的安排，所以，曼谷+芭提雅+泰南的苏梅+涛岛，事实证明大家很满意。</p>
<p>曼谷是购物之都，大皇宫父母只呆了不到半小时，就吵着要逛街。所以，在最后两天在曼谷购物，不然，提着大小包去玩可是很辛苦。<br>芭提雅离曼谷近，大巴2小时，方便随时，并且沿海热闹。并不细说，我老婆最钟爱此地。但并不上岛，因为后面有好戏。<br>苏梅+岛，四天的深度感受，才能让大家忘记北方的寒冷和帝都的#￥￥%#。</p>
<p>飞前倒数一个半月，去搞定签证，在网上找可信的旅行社带办，一人花费2百多吧。</p>
<p>倒数一周时，换外币，因为换币要提前预约的，不然，很可能白跑一趟，我是在中国银行柜台办理的，据说汇率低。<br>不用换太多美金，真用不上。甚至不用换。我在华夏卡里存了6K（号称每天第一次取钱免手续费，但好像至少会有50铢会被当地ATM扣）<br>具体的安排：<br>华夏存入6K<br>换美金1K（本人中间有马来西亚的transit，出关玩了半天，所以，其实应该直接换马币）<br>换泰铢4K<br>当然，要带信用卡喽</p>
<p>倒数第四天时，下淘宝单，买电话卡，happy-7day卡。虽然，电话功能只用了不超过五次，但随时上网帮了很多的忙。因为，要收发订单邮件的和各种app的使用。7天过期后本人找到服务点，加了两天的上网约110铢</p>
<p>倒数第三天，网上值机，打印登机牌，打印各种订单确认（住宿酒店确认，地址信息等）和地图资源（一般酒店大堂都提供）。把手机的旅行app整理到一个文件夹，下载最新版本，先登陆上所有出游app帐号，以防到时找不到帐号，影响大事。<br>本人的app介绍如下：（重要程度，由上至下）<br>google maps<br>booking.com<br>面包自由行<br>穷游<br>私人邮箱设置<br>亚航</p>
<p>途牛<br>携程<br>蚂蜂窝自由行</p>
<p>前四位很强大，他们会互相配合，这里要赞一下面包。我在面包上订了一个安通海洋公园和一个人妖秀，都是质量很高，前一天下单，第二天享受，当然，要拿确认邮件去享受了。当然有条件的话，可以打印出来。泰国的IT水平不高，找到愿意让你使用的打印机很难的。酒店的服务人员不会同意，因为上网有风险，并且电脑都为公用。而没有像中国一样的打印复印店的。所以，你只能找office了，幸好有好心的人帮助。我转发邮件给他，他打印出来。面包上的景点也都可以关联google导航定位。这样，离的近或打车前去，大可尽在掌握。<br>再有就是booking.com了，的确专业，对订单反应速度巨快，可以结合苹果的passbook。</p>
<p>文化章节：<br>喝白酒的人注意，泰国找不到白酒，并且，早餐很难找，因为，上午开店的很少。在寺庙不要吵，也不用交门票。</p>
<p>详细行程一览表：</p>
<p><table width="100%"></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td width="17%">地点/时间/逗留</td></p>
<p><td width="12%">源–目标机场</td></p>
<p><td width="12%">景点</td></p>
<p><td width="11%">事后总结（有血的教训）</td><br></p>
<p><tr></tr></p>
<p><td width="16%">北京/马来西亚</td></p>
<p><td width="8%">PEK—KUL</td></p>
<p><td width="16%">马来西亚–双子塔–central park–机场商圈</td></p>
<p><td width="16%">事实上到了central market玩了半天，吃了个饭。有一个30分钟的快轨klia2直达central.</td><br></p>
<p><tr></tr></p>
<p><td width="16%">马来西亚/曼谷</td></p>
<p><td width="8%">KUL–DMK</td></p>
<p><td width="16%">体验美食，然后休息</td></p>
<p><td width="16%">到达天黑了，入住，准备第二天一早出发芭提雅</td><br></p>
<p><tr></tr></p>
<p><td width="16%">曼谷/芭提雅</td></p>
<p><td width="8%">坐BTS至下面站之一：1）victoryment station｜胜利纪念碑（阿怒烧瓦里拆）2）E7｜曼谷市东站｜Ekkamai｜Eastern Bus Terminal，2号口出就是东站。注：租用面包车.汽车北站(Mo chit)</td></p>
<p><td width="16%">四方水上市场另一个响亮名字是杜拉拉水上市场（最好提前网购票）可以坐香蕉船，照相，购物，看表演。中午后人开始多，我们去早了。</td></p>
<p><td width="16%">事实上，酒店前台安排了前往芭提雅的家庭型车，5人一共2000铢</td><br></p>
<p><tr></tr></p>
<p><td width="16%">巴堤雅</td></p>
<p><td width="8%">原路返曼谷</td></p>
<p><td width="16%">东芭乐园，室内民俗表演，大象表演，骑大象，旅游车参观等。到当地后订房两晚，200人民币一晚，有游泳池，比较舒适。</td></p>
<p><td width="16%">在著名的红灯区街walking street的西北部找了个性价比很高的酒店，记往在海滩的外圈找，那里会便宜。吃海鲜，游泳，逛街（晚上去，你懂的）</td><br></p>
<p><tr></tr></p>
<p><td width="16%">芭提雅/曼谷</td></p>
<p><td width="8%"></td></p>
<p><td width="16%">当地订房一晚，19，200人民币一晚</td></p>
<p><td width="16%">大巴车，坐到离廊曼机场近的站，在那里现找酒店，因为要赶飞机去苏梅，到曼后晚间逛了跳蚤市场，咋都咋（东西很多，但必须狠讲价，比MBK的价水份还大）</td><br></p>
<p><tr></tr></p>
<p><td width="16%">苏梅岛/20-22</td></p>
<p><td width="8%">DMK–NST车船联：大巴–&gt;–<br>Donsak码头-&gt;—<br>Lipa Noi Pier（苏梅亚航集合地）–&gt;-面包车-&gt;-酒店</td></p>
<p><td width="16%">查汶海滩（Chaweng Beach）、波普海滩（Borphut Beach）、拉迈海滩（Lamai Beach）和湄南海滩（Maenam Beach）。</td></p>
<p><td width="16%">海岛的房间紧张，所以用booking.com早下手了。海难上很热闹，水果很便宜。用面包app订了安通海洋公园，做快艇，浮潜，皮划艇，自助，实在是印象深刻，非常推荐。</td><br></p>
<p><tr></tr></p>
<p><td width="16%">龟岛（TAO）/23-24</td></p>
<p><td width="8%">nakhon si thammarat(NST) –bangkok-Don mueang(DMK)车船联：<br>酒店–&gt;–Seatran pier-&gt;–Donsak pier–&gt;–大巴-&gt;-机场-16:10-&gt;-FD3187–&gt;-17:30-</td></p>
<p><td width="16%">潜水,南苑岛,mahead bea(海滩)，购物街很多</td></p>
<p><td width="16%">岛上出租车很贵，要由酒店前台来叫。并且，按地图规划好下车地和游览路线。由于有孩子，不能去南苑岛和潜水。有几个购物区路线。逛的同时，看到了离岛的码头Seatran pier 那里有亚航的接待点，车船联票的入口。</td><br></p>
<p><tr></tr></p>
<p><td width="16%">龟岛/曼谷/24-26</td></p>
<p><td width="8%">DMK–KUL</td></p>
<p><td width="16%">大船–7座小巴–飞机</td></p>
<p><td width="16%">一天用来赶路，做大船不用很颠婆。有钱的可以从苏梅飞。</td><br></p>
<p><tr></tr></p>
<p><td width="16%">曼谷/北京</td></p>
<p><td width="8%">KUL–PEK</td></p>
<p><td width="16%">唐人街，泰拳，nana街</td></p>
<p><td width="16%">找到大皇宫附近的宾馆住下，第二天路线是，大皇宫，考山路，王权免税店，MBK，克里索普人妖秀。注意，去王权要拿两样东东，护照（本人全程随身）还有是打折地图（免费领于酒店前台，上面有打折卡的）。买的东东可以在机场退税。还有就是湄南河边的人妖秀了。风景和文化大餐。人妖秀很艺术，每个位子送一种自选饮品。第二天，飞京略</td><br><br><br><br>囧点：<br>1）买了个超标的箱子，只能托运，而又没买20kg的行李托运，在机场又要登机了，结果高价买了托运–600银子。<br>2）爸有个小军刀，老婆有些化妆品被安检拦了，幸好，有免费的寄存，等回来北京后，从机场拿走。<br>3）爸妈先抵泰国机场，对于入境卡拒填，他以为那个是落地签，语言又不通，真是难为他们了。 汇合后出了机场，打不到taxi，因为，机场很规范，有专门的打的通道，要排队，就一定有打表的taxi。<br>4）上了车，老爸习惯的往副驾驶一座，可是，司机就站在旁边，比划了半天，老爸往前一看，原来有方向盘。<br>5）注意，泰铢纸币的1K和100的特别相近，本人就大方的给了1K的小费。<br>6）由于经停马来西亚，本人换了马币，可返程时赶飞机，没有消费掉剩下的钱，结果，回国后发现中国银行不能换马币。结果，留做纪念了。还有若干泰铢硬币。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/08/vs2013-e5-ad-97-e7-ac-a6-e9-9b-86-e5-b0-8f-e7-bb-93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/08/vs2013-e5-ad-97-e7-ac-a6-e9-9b-86-e5-b0-8f-e7-bb-93/" itemprop="url">VS2013字符集小结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-08T14:42:27+08:00">
                2015-12-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/" itemprop="url" rel="index">
                    <span itemprop="name">c/C++</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-C/开发语言/" itemprop="url" rel="index">
                    <span itemprop="name">开发语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>VS新版本打开旧项目，即当升级一个vcproject文件时，可能会涉及从“多字节字符集”（可能是utf-8）到unicode字符集的转换。<br>所以总结一下，代码端如何适应转换。</p>
<p>unicode字符集下，微软引入了一个宽字符集的概念（多讨厌）<br>所以，有些winapi就是以宽字符集来传参的。</p>
<p>第一类问题：messagebox()函数<br>所以字符串常量前，加一个L，即L“原来的字符串”；<br>L的意思是小端序。当为unicode时，长度要么1要么2（汉字），所以，再加上小端序，不会有歧义了。</p>
<p>第二类问题：strcpy()函数要求多字符集，事实此时的CSting已经入乡随俗了用了宽字符集，而直接强制转换就会出现让你头大的提示，<br>居然const char * 和 CString不等价了。</p>
<p>char SendBuf[512] = {0};</p>
<pre><code>strcpy(SendBuf,strEdit);              //CString参数strEdit，报错说不能转换CString到const char *
</code></pre><hr>
<p>办法一：用新的缓冲区放置，并且必须再转换一下。<br>char SendBuf[512] = {0};<br>    strcpy(SendBuf,( const char *)strEdit.GetBuffer());<br>办法二：复杂，此时要做的是把“变质的”CString给救回来。</p>
<p>char SendBuf[512] = {0};<br>    wchar_t temp[512];<br>    MultiByteToWideChar(CP_ACP, NULL, (LPCCH)strEdit.GetBuffer(), 512, temp, 512);<br>    strcpy(SendBuf,(const char *)temp);<br>    m_Conn.Send(SendBuf,strlen(SendBuf));</p>
<p>第三类问题，atoi转int:<br>把atoi换成_ttoi即可，这是神器，在啥字符集下，都可编译。</p>
<p>第四类问题，CString-&gt;std::string 举例如下：<br>CString strMfc=“test“;<br>std::string strStl;</p>
<p>#ifdef _UNICODE</p>
<p>USES_CONVERSION<br>strStl=W2A(strMfc.LockBuffer());</p>
<p>strMfc.UnlockBuffer();</p>
<p>#else</p>
<p>strStl = strMfc.GetBuffer(0);</p>
<p>strMfc.ReleaseBuffer();</p>
<h2 id="endif"><a href="#endif" class="headerlink" title="#endif"></a>#endif</h2><p>有时，CString可以做为桥梁，把乱码的UTF-8字符串转成string打印正确。思路是先用下面的函数转换乱码，再把返回的CString转string.<br>CString UTF8toUnicode(const char* utf8Str, UINT length)<br>{<br>    CString unicodeStr;<br>    unicodeStr = _T(“”);<br>    if (!utf8Str)<br>        return unicodeStr;</p>
<pre><code>if (length == 0)
    return unicodeStr;

//转换 
WCHAR chr = 0;

for (UINT i = 0; i&lt;length;)
{
    if ((0x80 &amp; utf8Str[i]) == 0) // ASCII 
    {
        chr = utf8Str[i];
        i++;
    }
    else if ((0xE0 &amp; utf8Str[i]) == 0xC0) // 110xxxxx 10xxxxxx 
    {
        chr = (utf8Str[i + 0] &amp; 0x3F) &lt;&lt; 6;
        chr |= (utf8Str[i + 1] &amp; 0x3F);
        i += 2;
    }
    else if ((0xF0 &amp; utf8Str[i]) == 0xE0) // 1110xxxx 10xxxxxx 10xxxxxx 
    {
        chr = (utf8Str[i + 0] &amp; 0x1F) &lt;&lt; 12;
        chr |= (utf8Str[i + 1] &amp; 0x3F) &lt;&lt; 6;
        chr |= (utf8Str[i + 2] &amp; 0x3F);
        i += 3;
    }
    else // 不是UTF-8字符串 
    {
        return unicodeStr;
    }
    unicodeStr.AppendChar(chr);
}

return unicodeStr;
</code></pre><p>}</p>
<p>CString UTF8toUnicode(const char* utf8Str)<br>{</p>
<pre><code>UINT theLength = strlen(utf8Str);
return UTF8toUnicode(utf8Str, theLength);
</code></pre><p>}</p>
<p>第五类问题：BSTR -&gt; std::string 举例如下<br>BSTR bstrTest = ::SysAllocString(L”Test”);</p>
<p>_bstr_t bstr_t(bstrTest）；</p>
<p>std::strStl = bstr_t;</p>
<p>SysFreeString(bstrTest );</p>
<p>std::string -&gt; BSTR 举例如下</p>
<p>std::string name = “nisb”;</p>
<p> _bstr_t bstr_t(name.c_str());</p>
<p>BSTR ret_val = bstr_t.GetBSTR();</p>
<hr>
<p>转来一篇原理编码的原理：</p>
<p>1：使用CString，要包含文件afx.h，比如在Win32 Console Application中Alt+F7选择Use MFC in a Static Liberary，然后再添加#include<afx.h>就可以使用CString了。</afx.h></p>
<p>  2：WCHAR ch = L’中’;与CHAR ch = ’中’;的区别是第一种使用UNICODE编码，第二种方式一般不经常用到，比如：<br>  WCHAR strA [ 2 ] = { L’中’ , 0 } ;//打开VC的Options菜单，选中Debug选项卡中的Display unicode strings后，可以看到strA的值。<br>  WCHAR strB [ 2 ] = { ‘中’ , 0 } ;</p>
<p>  CString strC ;</p>
<p>  strC+ = ( ( char <em> ) strB ) [ 1 ] ;<br>  strC+ = ( ( char </em> ) strB ) [ 0 ] ;//strC==”中”</p>
<p>  3：CString的AllocSysString ( )成员函数;可以方便的把一个字符串转换成UNICODE形式。记得使用完该UNICODE字符串后要调用::SysFreeString()函数释放字符串。</p>
<p>  4: CString::AllocSysString ( )或者::SysAllocString得到的字符串并不是普通的UNICODE字符串，它之前的四个字节会存放申请的字符串的长度：</p>
<p>  CString strD = ”asdf”;<br>  BSTR strD = strC.AllocSysString( ) ;<br>  long i =<em> ( ( long </em> ) strD – 1 ) ; // i == 8;一个UNICDE字符的长度是2字节，所以strD的长度为8个字节。</p>
<p>  4：UTF-8码转换为一般的字符串：</p>
<p>  #include “ Windows.h “</p>
<p>  int main(void)<br>  {<br>  char str [ 256 ] = {( char )0xE4, ( char ) 0xBD, ( char ) 0xA0, ( char ) 0xE5 ,<br>  ( char)0xA5 ,(char)0xBD, (char)0x61, (char)0x62 ,(char)0x63,(char)0} ; //一段UTF-8编码<br>  WCHAR<em> strA;<br>  int i= MultiByteToWideChar ( CP_UTF8 , 0 ,(char</em>) str ,-1 ,NULL,0);<br>  strA = new WCHAR[i];<br>  MultiByteToWideChar ( CP_UTF8 , 0 ,( char <em> ) str, -1, strA , i );<br>  i= WideCharToMultiByte(CP_ACP,0,strA,-1,NULL,0,NULL,NULL);<br>  char </em>strB=new char[i];<br>  WideCharToMultiByte (CP_ACP,0,strA,-1,strB,i,NULL,NULL);<br>  //strB即为所求<br>  delete []strA;<br>  delete []strB;<br>  return 0;<br>  }</p>
<p>  5：在转换方面_bstr_t是最最灵活的，他提供了UNICODE到一般字符串的直接转换：</p>
<p>  #include <comdef.h><br>  _bstr_t strA;<br>  char <em>strB=”中国人”;<br>  strA=strB;<br>  WCHAR </em>strC=strA;<br>  long i =<em> ( ( long </em> ) strC - 1 ) ;// i 亦是字符串的字节长度<br>  char *strD=strA;<br>  return 0;</comdef.h></p>
<p>宽窄字串转换！<br>  两种方法：1、CString 2、_bstr_t</p>
<p>  #include “comutil.h”<br>  //注意在Project－》Setting－》Link中加入comsupp.lib,从而使_bstr_t可用</p>
<p>  void CAaaDlg::OnButton1()<br>  {<br>  // TODO: Add extra cleanup here<br>  _bstr_t a(L”sdfsafds”);<br>  a+=”zzz”;<br>  char <em> b = (char </em>)a;//获得内部BSTR的char<em>指针，勿做修改和释放<br>  WCHAR </em>c=(WCHAR <em>)a;//获得内部BSTR的WCHARr</em>指针，勿做修改和释放<br>  CString p = L”asdfsa”;<br>  p+=”ppp”;<br>  WCHAR <em>y =p.AllocSysString(); //获得WCHAR</em>指针，使用完请释放，否则有内存泄漏。<br>  char *z = p.GetBuffer(p.GetLength()+1);//内部Buffer指针，z不要释放</p>
<p>  ::SysFreeString(y);<br>  }</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/12/04/net-e5-ba-94-e7-94-a8odp-net-e5-b0-8f-e8-ae-b0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ohala">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大亮的实验室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/12/04/net-e5-ba-94-e7-94-a8odp-net-e5-b0-8f-e8-ae-b0/" itemprop="url">.net应用odp.net小记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-12-04T18:03:09+08:00">
                2015-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-net/" itemprop="url" rel="index">
                    <span itemprop="name">c#.net</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/c-net/开发语言/" itemprop="url" rel="index">
                    <span itemprop="name">开发语言</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一，下载ODAC112040Xcopy_64bit并解压，在OTP里找。<br>     在cmd中执行&gt;install.bat odp.net4 d:\driver4oracle11.2 odac</p>
<pre><code>odp.net4------------你想部署的driver，本人使用.netframework4，不是asp.net和.net2，所以，没用使用All和指定的其它选项。
d:\driver4oracle11.2------------你要部署的目标客户机的oracle_home，当然在windows下就加入它到系统环境变量path中。
odac------------当在同目录有多个driver时，可以区别吧，反正，因为加了它，可能会报错。但不影响使用。
[true]----------可选的，默认值，即把odp.net依赖的instantclient安装，当你加false时，不装依赖且考虑和已经存在的新版本oracle或现有的环境配合。

当执行了上面的命令后，instantclient(即被odp.net依赖的)也一并从压缩包中被抽取，拷安装到了oracle_home目录中。
</code></pre><p>二，然后就是设置tnsnames.ora文件。从服务端上相应位置拷过来，放置到home目录中。顺便执行下*access.dll同目录中的oraprovcfg.exe，它是用于注册系统环境变量的。虽然上面已经配置好了，多来一次也无妨。</p>
<p>三，开始客户端程序的开发吧，把home路径中的Oracle.DataAccess.dll拷到项目的debug，和exe同级下面，并在VS中引用，加入using行：<br>     using Oracle.DataAccess.Client;<br>     using Oracle.DataAccess.Types;<br>     代码示例：</p>
<p>using System;<br>using System.Collections.Generic;<br>using System.ComponentModel;<br>using System.Data;<br>using System.Drawing;<br>using System.Linq;<br>using System.Text;<br>using System.Windows.Forms;<br>using Oracle.DataAccess.Client;<br>using Oracle.DataAccess.Types;</p>
<p>namespace odp<br>{<br>    public partial class Form1 : Form<br>    {<br>        public Form1()<br>        {<br>            InitializeComponent();</p>
<pre><code>    }

    private string strConn = &quot;Data Source=(DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = ohala-PC)(PORT = 1521))(CONNECT_DATA = (SERVER = DEDICATED)(SERVICE_NAME = XE)));&quot;+
        &quot;User id=JINGHU;Password=JINGHU;&quot; ;
    public void initDBConn()
    {
        try
        {
            using(OracleConnection objConn = new OracleConnection(strConn))
            {
                objConn.Open();
                string strSQL = &quot;select * from V_TM_SEGMENT_CFG where SEGMENT_CODE=10 order by STATION_SEQUENCE,TRACK_CODE&quot;;

                using(OracleDataAdapter objAdapter = new OracleDataAdapter(strSQL,objConn))
                {
                    //
                    DataSet ds = new DataSet();
                    objAdapter.Fill(ds);
                    dataGridView1.DataSource = ds.Tables[0];
                    //dataGridView1.
                    dataGridView1.Show();
                }

                //using (OracleCommand objCommand = new OracleCommand(strSQL, objConn))
                //{
                //    using(OracleDataReader objReader = objCommand.ExecuteReader())
                //    {
                //        while (objReader.Read())
                //        {
                //            Console.WriteLine(&quot;segment_code is :&quot; + objReader[0].ToString() + &quot;;station_code is :&quot; + objReader[1].ToString());
                //            //dataGridView1.DataSource
                //        }

                //    }
                //}//command
            }
        } catch(Exception ex)
        {

        }
    }

    private void button1_Click(object sender, EventArgs e)
    {
        initDBConn();
    }
}
</code></pre><p>}</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ohala</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/page.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/tags.html">
                  <span class="site-state-item-count">110</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ohala</span>

  
</div>


  <div class="powered-by">感谢来访，欢迎指教 <a class="theme-link" target="_blank" href="mailto:wsdy007@sina.com">e_mail</a> </div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">回大本营喽： &mdash; <a class="theme-link" target="_blank" href="http://blog.songdaliang.com">motherland</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
